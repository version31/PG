!function(){var j={},i=function(a){for(var v=j[a],u=v.deps,t=v.defn,s=u.length,r=new Array(s),q=0;q<s;++q){r[q]=o(u[q])}var d=t.apply(null,r);if(void 0===d){throw"module ["+a+"] returned undefined"}v.instance=d},p=function(a,f,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===f){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}j[a]={deps:f,defn:e,instance:void 0}},o=function(b){var a=j[b];if(void 0===a){throw"module ["+b+"] was undefined"}return void 0===a.instance&&i(b),a.instance},n=function(g,d){for(var r=g.length,q=new Array(r),h=0;h<r;++h){q.push(o(g[h]))}d.apply(null,d)},m={};m.bolt={module:{api:{define:p,require:n,demand:o}}};var l=p,k=function(d,c){l(d,[],function(){return c})};k("6",tinymce.util.Tools.resolve),l("1",["6"],function(b){return b("tinymce.EditorManager")}),l("2",["6"],function(b){return b("tinymce.PluginManager")}),l("3",["6"],function(b){return b("tinymce.util.LocalStorage")}),l("4",["6"],function(b){return b("tinymce.util.Tools")}),k("5",window),l("0",["1","2","3","4","5"],function(g,f,r,q,h){return g._beforeUnloadHandler=function(){var a;return q.each(g.editors,function(b){b.plugins.autosave&&b.plugins.autosave.storeDraft(),!a&&b.isDirty()&&b.getParam("autosave_ask_before_unload",!0)&&(a=b.translate("You have unsaved changes are you sure you want to navigate away?"))}),a},f.add("autosave",function(A){function z(C,B){var D={s:1000,m:60000};return C=/^(\d+)([ms]?)$/.exec(""+(C||B)),(C[2]?D[C[2]]:1)*parseInt(C,10)}function y(){var b=parseInt(r.getItem(d+"time"),10)||0;return !((new Date).getTime()-b>a.autosave_retention)||(x(!1),!1)}function x(b){r.removeItem(d+"draft"),r.removeItem(d+"time"),b!==!1&&A.fire("RemoveDraft")}function w(){!e()&&A.isDirty()&&(r.setItem(d+"draft",A.getContent({format:"raw",no_events:!0})),r.setItem(d+"time",(new Date).getTime()),A.fire("StoreDraft"))}function v(){y()&&(A.setContent(r.getItem(d+"draft"),{format:"raw"}),A.fire("RestoreDraft"))}function u(){c||(setInterval(function(){A.removed||w()},a.autosave_interval),c=!0)}function t(){var b=this;b.disabled(!y()),A.on("StoreDraft RestoreDraft RemoveDraft",function(){b.disabled(!y())}),u()}function s(){A.undoManager.beforeChange(),v(),x(),A.undoManager.add()}function e(b){var B=A.settings.forced_root_block;return b=q.trim("undefined"==typeof b?A.getBody().innerHTML:b),""===b||new RegExp("^<"+B+"[^>]*>((\xa0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+B+">|<br>$","i").test(b)}var d,c,a=A.settings;d=a.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-",d=d.replace(/\{path\}/g,document.location.pathname),d=d.replace(/\{query\}/g,document.location.search),d=d.replace(/\{id\}/g,A.id),a.autosave_interval=z(a.autosave_interval,"30s"),a.autosave_retention=z(a.autosave_retention,"20m"),A.addButton("restoredraft",{title:"Restore last draft",onclick:s,onPostRender:t}),A.addMenuItem("restoredraft",{text:"Restore last draft",onclick:s,onPostRender:t,context:"file"}),A.settings.autosave_restore_when_empty!==!1&&(A.on("init",function(){y()&&e()&&v()}),A.on("saveContent",function(){x()})),h.onbeforeunload=g._beforeUnloadHandler,this.hasDraft=y,this.storeDraft=w,this.restoreDraft=v,this.removeDraft=x,this.isEmpty=e}),function(){}}),o("0")()}();