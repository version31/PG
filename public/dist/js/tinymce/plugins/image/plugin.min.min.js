!function(){var j={},i=function(a){for(var v=j[a],u=v.deps,t=v.defn,s=u.length,r=new Array(s),q=0;q<s;++q){r[q]=o(u[q])}var d=t.apply(null,r);if(void 0===d){throw"module ["+a+"] returned undefined"}v.instance=d},p=function(a,f,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===f){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}j[a]={deps:f,defn:e,instance:void 0}},o=function(b){var a=j[b];if(void 0===a){throw"module ["+b+"] was undefined"}return void 0===a.instance&&i(b),a.instance},n=function(g,d){for(var r=g.length,q=new Array(r),h=0;h<r;++h){q.push(o(g[h]))}d.apply(null,d)},m={};m.bolt={module:{api:{define:p,require:n,demand:o}}};var l=p,k=function(d,c){l(d,[],function(){return c})};k("6",tinymce.util.Tools.resolve),l("1",["6"],function(b){return b("tinymce.Env")}),l("2",["6"],function(b){return b("tinymce.PluginManager")}),l("3",["6"],function(b){return b("tinymce.util.JSON")}),l("4",["6"],function(b){return b("tinymce.util.Tools")}),l("5",["6"],function(b){return b("tinymce.util.XHR")}),l("0",["1","2","3","4","5"],function(g,f,r,q,h){return f.add("image",function(a){function s(u,t){function x(b,y){w.parentNode&&w.parentNode.removeChild(w),t({width:b,height:y})}var w=document.createElement("img");w.onload=function(){x(Math.max(w.width,w.clientWidth),Math.max(w.height,w.clientHeight))},w.onerror=function(){x()};var v=w.style;v.visibility="hidden",v.position="fixed",v.bottom=v.left=0,v.width=v.height="auto",document.body.appendChild(w),w.src=u}function e(u,t,w){function v(b,x){return x=x||[],q.each(b,function(y){var z={text:y.text||y.title};y.menu?z.menu=v(y.menu):(z.value=y.value,t(z)),x.push(z)}),x}return v(u,w||[])}function d(b){return function(){var t=a.settings.image_list;"string"==typeof t?h.send({url:t,success:function(u){b(r.parse(u))}}):"function"==typeof t?t(b):b(t)}}function c(R){function Q(){var u,t,w,v;u=I.find("#width")[0],t=I.find("#height")[0],u&&t&&(w=u.value(),v=t.value(),I.find("#constrain")[0].checked()&&F&&E&&w&&v&&(F!=w?(v=Math.round(w/F*v),isNaN(v)||t.value(v)):(w=Math.round(v/E*w),isNaN(w)||u.value(w))),F=w,E=v)}function P(){function t(w){function x(){w.onload=w.onerror=null,a.selection&&(a.selection.select(w),a.nodeChanged())}w.onload=function(){B.width||B.height||!z||A.setAttribs(w,{width:w.clientWidth,height:w.clientHeight}),x()},w.onerror=x}var v,u;K(),Q(),B=q.extend(B,I.toJSON()),B.alt||(B.alt=""),B.title||(B.title=""),""===B.width&&(B.width=null),""===B.height&&(B.height=null),B.style||(B.style=null),B={src:B.src,alt:B.alt,title:B.title,width:B.width,height:B.height,style:B.style,caption:B.caption,"class":B["class"]},a.undoManager.transact(function(){function x(y){return a.schema.getTextBlockElements()[y.nodeName]}if(!B.src){return void (H&&(A.remove(H),a.focus(),a.nodeChanged()))}if(""===B.title&&(B.title=null),H?A.setAttribs(H,B):(B.id="__mcenew",a.focus(),a.selection.setContent(A.createHTML("img",B)),H=A.get("__mcenew"),A.setAttrib(H,"id",null)),a.editorUpload.uploadImagesAuto(),B.caption===!1&&A.is(H.parentNode,"figure.image")&&(v=H.parentNode,A.insertAfter(H,v),A.remove(v)),B.caption!==!0){t(H)}else{if(!A.is(H.parentNode,"figure.image")){u=H,H=H.cloneNode(!0),v=A.create("figure",{"class":"image"}),v.appendChild(H),v.appendChild(A.create("figcaption",{contentEditable:!0},"Caption")),v.contentEditable=!1;var w=A.getParent(u,x);w?A.split(w,u,v):A.replace(v,u),a.selection.select(v)}}})}function O(t){return t&&(t=t.replace(/px$/,"")),t}function N(t){var x,w,v,u=t.meta||{};D&&D.value(a.convertURL(this.value(),"src")),q.each(u,function(S,y){I.find("#"+y).value(S)}),u.width||u.height||(x=a.convertURL(this.value(),"src"),w=a.settings.image_prepend_url,v=new RegExp("^(?:[a-z]+:)?//","i"),w&&!v.test(x)&&x.substring(0,w.length)!==w&&(x=w+x),this.value(x),s(a.documentBaseURI.toAbsolute(this.value()),function(y){y.width&&y.height&&z&&(F=y.width,E=y.height,I.find("#width").value(F),I.find("#height").value(E))}))}function M(t){t.meta=I.toJSON()}function L(u){if(u.margin){var t=u.margin.split(" ");switch(t.length){case 1:u["margin-top"]=u["margin-top"]||t[0],u["margin-right"]=u["margin-right"]||t[0],u["margin-bottom"]=u["margin-bottom"]||t[0],u["margin-left"]=u["margin-left"]||t[0];break;case 2:u["margin-top"]=u["margin-top"]||t[0],u["margin-right"]=u["margin-right"]||t[1],u["margin-bottom"]=u["margin-bottom"]||t[0],u["margin-left"]=u["margin-left"]||t[1];break;case 3:u["margin-top"]=u["margin-top"]||t[0],u["margin-right"]=u["margin-right"]||t[1],u["margin-bottom"]=u["margin-bottom"]||t[2],u["margin-left"]=u["margin-left"]||t[1];break;case 4:u["margin-top"]=u["margin-top"]||t[0],u["margin-right"]=u["margin-right"]||t[1],u["margin-bottom"]=u["margin-bottom"]||t[2],u["margin-left"]=u["margin-left"]||t[3]}delete u.margin}return u}function K(){function t(w){return w.length>0&&/^[0-9]+$/.test(w)&&(w+="px"),w}if(a.settings.image_advtab){var v=I.toJSON(),u=A.parseStyle(v.style);u=L(u),v.vspace&&(u["margin-top"]=u["margin-bottom"]=t(v.vspace)),v.hspace&&(u["margin-left"]=u["margin-right"]=t(v.hspace)),v.border&&(u["border-width"]=t(v.border)),I.find("#style").value(A.serializeStyle(A.parseStyle(A.serializeStyle(u))))}}function J(){if(a.settings.image_advtab){var t=I.toJSON(),u=A.parseStyle(t.style);I.find("#vspace").value(""),I.find("#hspace").value(""),u=L(u),(u["margin-top"]&&u["margin-bottom"]||u["margin-right"]&&u["margin-left"])&&(u["margin-top"]===u["margin-bottom"]?I.find("#vspace").value(O(u["margin-top"])):I.find("#vspace").value(""),u["margin-right"]===u["margin-left"]?I.find("#hspace").value(O(u["margin-right"])):I.find("#hspace").value("")),u["border-width"]&&I.find("#border").value(O(u["border-width"])),I.find("#style").value(A.serializeStyle(A.parseStyle(A.serializeStyle(u))))}}var I,H,G,F,E,D,C,B={},A=a.dom,z=a.settings.image_dimensions!==!1;H=a.selection.getNode(),G=A.getParent(H,"figure.image"),G&&(H=A.select("img",G)[0]),H&&("IMG"!=H.nodeName||H.getAttribute("data-mce-object")||H.getAttribute("data-mce-placeholder"))&&(H=null),H&&(F=A.getAttrib(H,"width"),E=A.getAttrib(H,"height"),B={src:A.getAttrib(H,"src"),alt:A.getAttrib(H,"alt"),title:A.getAttrib(H,"title"),"class":A.getAttrib(H,"class"),width:F,height:E,caption:!!G}),R&&(D={type:"listbox",label:"Image list",values:e(R,function(t){t.value=a.convertURL(t.value||t.url,"src")},[{text:"None",value:""}]),value:B.src&&a.convertURL(B.src,"src"),onselect:function(u){var t=I.find("#alt");(!t.value()||u.lastControl&&t.value()==u.lastControl.text())&&t.value(u.control.text()),I.find("#src").value(u.control.value()).fire("change")},onPostRender:function(){D=this}}),a.settings.image_class_list&&(C={name:"class",type:"listbox",label:"Class",values:e(a.settings.image_class_list,function(t){t.value&&(t.textStyle=function(){return a.formatter.getCssText({inline:"img",classes:[t.value]})})})});var b=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:N,onbeforecall:M},D];a.settings.image_description!==!1&&b.push({name:"alt",type:"textbox",label:"Image description"}),a.settings.image_title&&b.push({name:"title",type:"textbox",label:"Image Title"}),z&&b.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:Q,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:Q,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),b.push(C),a.settings.image_caption&&g.ceFalse&&b.push({name:"caption",type:"checkbox",label:"Caption"}),a.settings.image_advtab?(H&&(H.style.marginLeft&&H.style.marginRight&&H.style.marginLeft===H.style.marginRight&&(B.hspace=O(H.style.marginLeft)),H.style.marginTop&&H.style.marginBottom&&H.style.marginTop===H.style.marginBottom&&(B.vspace=O(H.style.marginTop)),H.style.borderWidth&&(B.border=O(H.style.borderWidth)),B.style=a.dom.serializeStyle(a.dom.parseStyle(a.dom.getAttrib(H,"style")))),I=a.windowManager.open({title:"Insert/edit image",data:B,bodyType:"tabpanel",body:[{title:"General",type:"form",items:b},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:J},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:K},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:P})):I=a.windowManager.open({title:"Insert/edit image",data:B,body:b,onSubmit:P})}a.on("preInit",function(){function b(v){var u=v.attr("class");return u&&/\bimage\b/.test(u)}function t(u){return function(y){function x(z){z.attr("contenteditable",u?"true":null)}for(var w,v=y.length;v--;){w=y[v],b(w)&&(w.attr("contenteditable",u?"false":null),q.each(w.getAll("figcaption"),x))}}}a.parser.addNodeFilter("figure",t(!0)),a.serializer.addNodeFilter("figure",t(!1))}),a.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:d(c),stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),a.addMenuItem("image",{icon:"image",text:"Image",onclick:d(c),context:"insert",prependToContext:!0}),a.addCommand("mceImage",d(c))}),function(){}}),o("0")()}();