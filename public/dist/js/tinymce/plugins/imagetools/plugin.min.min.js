!function(){var j={},i=function(a){for(var v=j[a],u=v.deps,t=v.defn,s=u.length,r=new Array(s),q=0;q<s;++q){r[q]=o(u[q])}var d=t.apply(null,r);if(void 0===d){throw"module ["+a+"] returned undefined"}v.instance=d},p=function(a,f,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===f){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}j[a]={deps:f,defn:e,instance:void 0}},o=function(b){var a=j[b];if(void 0===a){throw"module ["+b+"] was undefined"}return void 0===a.instance&&i(b),a.instance},n=function(g,d){for(var r=g.length,q=new Array(r),h=0;h<r;++h){q.push(o(g[h]))}d.apply(null,d)},m={};m.bolt={module:{api:{define:p,require:n,demand:o}}};var l=p,k=function(d,c){l(d,[],function(){return c})};l("o",[],function(){function z(d,c){return function(){d.apply(c,arguments)}}function y(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],s(a,z(w,this),z(v,this))}function x(d){var c=this;return null===this._state?void this._deferreds.push(d):void r(function(){var f=a._state?d.onFulfilled:d.onRejected;if(null===f){return void (a._state?d.resolve:d.reject)(a._value)}var e;try{e=f(a._value)}catch(a){return void d.reject(a)}d.resolve(e)})}function w(d){try{if(d===this){throw new TypeError("A promise cannot be resolved with itself.")}if(d&&("object"==typeof d||"function"==typeof d)){var f=d.then;if("function"==typeof f){return void s(e(f,d),e(w,this),e(v,this))}}this._state=!0,this._value=d,u.call(this)}catch(e){v.call(this,e)}}function v(b){this._state=!1,this._value=b,u.call(this)}function u(){for(var d=0,c=this._deferreds.length;d<c;d++){x.call(this,this._deferreds[d])}this._deferreds=null}function t(f,e,h,g){this.onFulfilled="function"==typeof f?f:null,this.onRejected="function"==typeof e?e:null,this.resolve=h,this.reject=g}function s(f,e,h){var g=!1;try{f(function(b){g||(g=!0,e(b))},function(b){g||(g=!0,h(b))})}catch(f){if(g){return}g=!0,h(f)}}if(window.Promise){return window.Promise}var r=y.immediateFn||"function"==typeof setImmediate&&setImmediate||function(b){setTimeout(b,1)},q=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)};return y.prototype["catch"]=function(b){return this.then(null,b)},y.prototype.then=function(b,f){var c=this;return new y(function(a,d){x.call(c,new t(b,f,a,d))})},y.all=function(){var b=Array.prototype.slice.call(1===arguments.length&&q(arguments[0])?arguments[0]:arguments);return new y(function(a,B){function A(C,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var d=e.then;if("function"==typeof d){return void d.call(e,function(f){A(C,f)},B)}}c[C]=e,0===--h&&a(c)}catch(c){B(c)}}if(0===b.length){return a([])}for(var h=b.length,g=0;g<b.length;g++){A(g,b[g])}})},y.resolve=function(b){return b&&"object"==typeof b&&b.constructor===y?b:new y(function(a){a(b)})},y.reject=function(b){return new y(function(a,d){d(b)})},y.race=function(b){return new y(function(a,h){for(var g=0,f=b.length;g<f;g++){b[g].then(a,h)}})},y}),l("p",[],function(){function g(d,c){return h(document.createElement("canvas"),d,c)}function f(a){var s,c;return s=g(a.width,a.height),c=r(s),c.drawImage(a,0,0),s}function r(b){return b.getContext("2d")}function q(d){var c=null;try{c=d.getContext("webgl")||d.getContext("experimental-webgl")}catch(d){}return c||(c=null),c}function h(e,d,s){return e.width=d,e.height=s,e}return{create:g,clone:f,resize:h,get2dContext:r,get3dContext:q}}),l("q",[],function(){function d(f){var e=document.createElement("a");return e.href=f,e.pathname}function c(a){var r,q,h,g;return 0===a.indexOf("data:")?(a=a.split(","),g=/data:([^;]+)/.exec(a[0]),g?g[1]:""):(h={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"},r=d(a).split("."),q=r[r.length-1],q&&(q=q.toLowerCase()),h[q])}return{guessMimeType:c}}),l("r",[],function(){function d(b){return b.naturalWidth||b.width}function c(b){return b.naturalHeight||b.height}return{getWidth:d,getHeight:c}}),l("c",["o","p","q","r"],function(F,E,D,C){function B(a){return new F(function(b){function d(){a.removeEventListener("load",d),b(a)}a.complete?b(a):a.addEventListener("load",d)})}function A(b){return B(b).then(function(d){var g,f;return f=E.create(C.getWidth(d),C.getHeight(d)),g=E.get2dContext(f),g.drawImage(d,0,0),f})}function z(b){return B(b).then(function(d){var c=d.src;return 0===c.indexOf("blob:")?x(c):0===c.indexOf("data:")?v(c):A(d).then(function(e){return v(e.toDataURL(D.guessMimeType(c)))})})}function y(a){return new F(function(b){function f(){e.removeEventListener("load",f),b(e)}var e=new Image;e.addEventListener("load",f),e.src=URL.createObjectURL(a),e.complete&&f()})}function x(a){return new F(function(b){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="blob",d.onload=function(){200==this.status&&b(this.response)},d.send()})}function w(G){var h,L,K,J,I,H;if(G=G.split(","),J=/data:([^;]+)/.exec(G[0]),J&&(I=J[1]),h=atob(G[1]),window.WebKitBlobBuilder){for(H=new WebKitBlobBuilder,L=new ArrayBuffer(h.length),K=0;K<L.length;K++){L[K]=h.charCodeAt(K)}return H.append(L),H.getBlob(I)}for(L=new Uint8Array(h.length),K=0;K<L.length;K++){L[K]=h.charCodeAt(K)}return new Blob([L],{type:I})}function v(a){return new F(function(b){b(w(a))})}function u(b){return 0===b.indexOf("blob:")?x(b):0===b.indexOf("data:")?v(b):null}function t(a,f,e){return f=f||"image/png",HTMLCanvasElement.prototype.toBlob?new F(function(b){a.toBlob(function(c){b(c)},f,e)}):v(a.toDataURL(f,e))}function s(a){return new F(function(b){var d=new FileReader;d.onloadend=function(){b(d.result)},d.readAsDataURL(a)})}function r(b){return s(b).then(function(c){return c.split(",")[1]})}function q(b){URL.revokeObjectURL(b.src)}return{blobToImage:y,imageToBlob:z,blobToDataUri:s,blobToBase64:r,imageToCanvas:A,canvasToBlob:t,revokeImageUrl:q,uriToBlob:u,dataUriToBlobSync:w}}),l("d",["o","c","q","p"],function(r,q,x,w){function v(b,C){function B(){return C}function A(c,a){return q.canvasToBlob(b,c||C,a)}function z(a,c){return b.toDataURL(a||C,c)}function y(e,c){return z(e,c).split(",")[1]}function d(){return w.clone(b)}return{getType:B,toBlob:A,toDataURL:z,toBase64:y,toCanvas:d}}function u(b){return q.blobToImage(b).then(function(d){var e=q.imageToCanvas(d);return q.revokeImageUrl(d),e}).then(function(a){return v(a,b.type)})}function t(a,d){return new r(function(b){b(v(a,d))})}function s(b){var c=x.guessMimeType(b.src);return q.imageToCanvas(b).then(function(d){return v(d,c)})}return{fromBlob:u,fromCanvas:t,fromImage:s}}),l("1",["c","d"],function(A,z){var y=function(a){return A.blobToImage(a)},x=function(a){return A.imageToBlob(a)},w=function(a){return A.blobToDataUri(a)},v=function(a){return A.blobToBase64(a)},u=function(b){return z.fromBlob(b)},t=function(a){return A.uriToBlob(a).then(z.fromBlob)},s=function(b){return z.fromImage(b)},r=function(e,d,f){return e.toBlob(d,f)},q=function(a,f,e){return A.dataUriToBlobSync(a.toDataURL(f,e))};return{blobToImage:y,imageToBlob:x,blobToDataUri:w,blobToBase64:v,blobToImageResult:u,dataUriToImageResult:t,imageToImageResult:s,imageResultToBlob:r,imageResultToBlobSync:q}}),l("s",[],function(){function B(e,d,f){return e=parseFloat(e),e>f?e=f:e<d&&(e=d),e}function A(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function z(D,C){var J,I,H,G,F=[],E=new Array(10);for(J=0;J<5;J++){for(I=0;I<5;I++){F[I]=C[I+5*J]}for(I=0;I<5;I++){for(G=0,H=0;H<5;H++){G+=D[I+5*H]*F[H]}E[I+5*J]=G}}return E}function y(a,d){return d=B(d,0,1),a.map(function(c,e){return e%6===0?c=1-(1-c)*d:c*=d,B(c,0,1)})}function x(a,f){var c;return f=B(f,-1,1),f*=100,f<0?c=127+f/100*127:(c=f%1,c=0===c?q[f]:q[Math.floor(f)]*(1-c)+q[Math.floor(f)+1]*c,c=127*c+127),z(a,[c/127,0,0,0,0.5*(127-c),0,c/127,0,0,0.5*(127-c),0,0,c/127,0,0.5*(127-c),0,0,0,1,0,0,0,0,0,1])}function w(a,F){var E,D,C,c;return F=B(F,-1,1),E=1+(F>0?3*F:F),D=0.3086,C=0.6094,c=0.082,z(a,[D*(1-E)+E,C*(1-E),c*(1-E),0,0,D*(1-E),C*(1-E)+E,c*(1-E),0,0,D*(1-E),C*(1-E),c*(1-E)+E,0,0,0,0,0,1,0,0,0,0,0,1])}function v(a,G){var F,E,D,C,c;return G=B(G,-180,180)/180*Math.PI,F=Math.cos(G),E=Math.sin(G),D=0.213,C=0.715,c=0.072,z(a,[D+F*(1-D)+E*-D,C+F*-C+E*-C,c+F*-c+E*(1-c),0,0,D+F*-D+0.143*E,C+F*(1-C)+0.14*E,c+F*-c+E*-0.283,0,0,D+F*-D+E*-(1-D),C+F*-C+E*C,c+F*(1-c)+E*c,0,0,0,0,0,1,0,0,0,0,0,1])}function u(a,c){return c=B(255*c,-255,255),z(a,[1,0,0,0,c,0,1,0,0,c,0,0,1,0,c,0,0,0,1,0,0,0,0,0,1])}function t(a,h,g,c){return h=B(h,0,2),g=B(g,0,2),c=B(c,0,2),z(a,[h,0,0,0,0,0,g,0,0,0,0,0,c,0,0,0,0,0,1,0,0,0,0,0,1])}function s(a,c){return c=B(c,0,1),z(a,y([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],c))}function r(a,c){return c=B(c,0,1),z(a,y([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],c))}var q=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:A,adjust:y,multiply:z,adjustContrast:x,adjustBrightness:u,adjustSaturation:w,adjustHue:v,adjustColors:t,adjustSepia:s,adjustGrayscale:r}}),l("e",["p","d","s"],function(y,x,w){function v(C,B){function A(ae,ad){var ac,ab,aa,Z,Y,X=ae.data,W=ad[0],V=ad[1],U=ad[2],T=ad[3],S=ad[4],R=ad[5],Q=ad[6],P=ad[7],N=ad[8],L=ad[9],K=ad[10],J=ad[11],I=ad[12],H=ad[13],G=ad[14],F=ad[15],E=ad[16],D=ad[17],O=ad[18],M=ad[19];for(Y=0;Y<X.length;Y+=4){ac=X[Y],ab=X[Y+1],aa=X[Y+2],Z=X[Y+3],X[Y]=ac*W+ab*V+aa*U+Z*T+S,X[Y+1]=ac*R+ab*Q+aa*P+Z*N+L,X[Y+2]=ac*K+ab*J+aa*I+Z*H+G,X[Y+3]=ac*F+ab*E+aa*D+Z*O+M}return ae}var z,b=C.toCanvas(),a=y.get2dContext(b);return z=A(a.getImageData(0,0,b.width,b.height),B),a.putImageData(z,0,0),x.fromCanvas(b,C.getType())}function u(D,C){function B(Y,X,W){function V(e,d,f){return e>f?e=f:e<d&&(e=d),e}var U,T,S,R,Q,P,O,N,M,L,K,J,I,H,G,F,E;for(S=Math.round(Math.sqrt(W.length)),R=Math.floor(S/2),U=Y.data,T=X.data,F=Y.width,E=Y.height,P=0;P<E;P++){for(Q=0;Q<F;Q++){for(O=N=M=0,K=0;K<S;K++){for(L=0;L<S;L++){J=V(Q+L-R,0,F-1),I=V(P+K-R,0,E-1),H=4*(I*F+J),G=W[K*S+L],O+=U[H]*G,N+=U[H+1]*G,M+=U[H+2]*G}}H=4*(P*F+Q),T[H]=V(O,0,255),T[H+1]=V(N,0,255),T[H+2]=V(M,0,255)}}return X}var A,z,b=D.toCanvas(),a=y.get2dContext(b);return A=a.getImageData(0,0,b.width,b.height),z=a.getImageData(0,0,b.width,b.height),z=B(A,z,C),a.putImageData(z,0,0),x.fromCanvas(b,D.getType())}function t(a){return function(E,D){function C(f,e){var h,g=f.data;for(h=0;h<g.length;h+=4){g[h]=e[g[h]],g[h+1]=e[g[h+1]],g[h+2]=e[g[h+2]]}return f}var B,A,z=E.toCanvas(),c=y.get2dContext(z),b=new Array(256);for(A=0;A<b.length;A++){b[A]=a(A,D)}return B=C(c.getImageData(0,0,z.width,z.height),b),c.putImageData(B,0,0),x.fromCanvas(z,E.getType())}}function s(b){return function(a,c){return v(a,b(w.identity(),c))}}function r(b){return function(a){return v(a,b)}}function q(b){return function(a){return u(a,b)}}return{invert:r([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:s(w.adjustBrightness),hue:s(w.adjustHue),saturate:s(w.adjustSaturation),contrast:s(w.adjustContrast),grayscale:s(w.adjustGrayscale),sepia:s(w.adjustSepia),colorize:function(d,c,h,g){return v(d,w.adjustColors(w.identity(),c,h,g))},sharpen:q([0,-1,0,-1,5,-1,0,-1,0]),emboss:q([-2,-1,0,-1,1,1,0,1,2]),gamma:t(function(d,c){return 255*Math.pow(d/255,1-c)}),exposure:t(function(d,c){return 255*(1-Math.exp(-(d/255)*c))}),colorFilter:v,convoluteFilter:u}}),l("t",["o","c","p","r"],function(h,g,t,s){function r(z,y,x){var w=s.getWidth(z),v=s.getHeight(z),u=y/w,f=x/v,e=!1;(u<0.5||u>2)&&(u=u<0.5?0.5:2,e=!0),(f<0.5||f>2)&&(f=f<0.5?0.5:2,e=!0);var d=q(z,u,f);return e?d.then(function(b){return r(b,y,x)}):d}function q(a,d,c){return new h(function(e){var x=s.getWidth(a),w=s.getHeight(a),v=Math.floor(x*d),u=Math.floor(w*c),f=t.create(v,u),b=t.get2dContext(f);b.drawImage(a,0,0,x,w,0,0,v,u),e(f)})}return{scale:r}}),l("f",["p","d","t"],function(q,h,v){function u(A,z){var y=A.toCanvas(),x=q.create(y.width,y.height),w=q.get2dContext(x),b=0,a=0;return z=z<0?360+z:z,90!=z&&270!=z||q.resize(x,x.height,x.width),90!=z&&180!=z||(b=x.width),270!=z&&180!=z||(a=x.height),w.translate(b,a),w.rotate(z*Math.PI/180),w.drawImage(y,0,0),h.fromCanvas(x,A.getType())}function t(y,x){var w=y.toCanvas(),b=q.create(w.width,w.height),a=q.get2dContext(b);return"v"==x?(a.scale(1,-1),a.drawImage(w,0,-b.height)):(a.scale(-1,1),a.drawImage(w,-b.width,0)),h.fromCanvas(b,y.getType())}function s(B,A,z,y,x){var w=B.toCanvas(),b=q.create(y,x),a=q.get2dContext(b);return a.drawImage(w,-A,-z),h.fromCanvas(b,B.getType())}function r(b,f,c){return v.scale(b.toCanvas(),f,c).then(function(a){return h.fromCanvas(a,b.getType())})}return{rotate:u,flip:t,crop:s,resize:r}}),l("2",["e","f"],function(J,I){var H=function(a){return J.invert(a)},G=function(a){return J.sharpen(a)},F=function(a){return J.emboss(a)},E=function(a,d){return J.gamma(a,d)},D=function(a,d){return J.exposure(a,d)},C=function(a,h,g,f){return J.colorize(a,h,g,f)},B=function(a,d){return J.brightness(a,d)},A=function(a,d){return J.hue(a,d)},z=function(a,d){return J.saturate(a,d)},y=function(a,d){return J.contrast(a,d)},x=function(a,d){return J.grayscale(a,d)},w=function(a,d){return J.sepia(a,d)},v=function(b,d){return I.flip(b,d)},u=function(b,r,q,h,g){return I.crop(b,r,q,h,g)},t=function(b,f,e){return I.resize(b,f,e)},s=function(b,d){return I.rotate(b,d)};return{invert:H,sharpen:G,emboss:F,brightness:B,hue:A,saturate:z,contrast:y,grayscale:x,sepia:w,colorize:C,gamma:E,exposure:D,flip:v,crop:u,resize:t,rotate:s}}),k("g",tinymce.util.Tools.resolve),l("3",["g"],function(b){return b("tinymce.Env")}),l("4",["g"],function(b){return b("tinymce.PluginManager")}),l("5",["g"],function(b){return b("tinymce.util.Delay")}),l("6",["g"],function(b){return b("tinymce.util.Promise")}),l("7",["g"],function(b){return b("tinymce.util.Tools")}),l("8",["g"],function(b){return b("tinymce.util.URI")}),l("9",[],function(){function e(h){function g(b){return/^[0-9\.]+px$/.test(b)}var r,q;return r=h.style.width,q=h.style.height,r||q?g(r)&&g(q)?{w:parseInt(r,10),h:parseInt(q,10)}:null:(r=h.width,q=h.height,r&&q?{w:parseInt(r,10),h:parseInt(q,10)}:null)}function d(h,g){var r,q;g&&(r=h.style.width,q=h.style.height,(r||q)&&(h.style.width=g.w+"px",h.style.height=g.h+"px",h.removeAttribute("data-mce-style")),r=h.width,q=h.height,(r||q)&&(h.setAttribute("width",g.w),h.setAttribute("height",g.h)))}function f(b){return{w:b.naturalWidth,h:b.naturalHeight}}return{getImageSize:e,setImageSize:d,getNaturalImageSize:f}}),l("h",["6","7"],function(q,h){var v=function(b){return null!==b&&void 0!==b},u=function(e,c){var f;return f=c.reduce(function(g,d){return v(g)?g[d]:void 0},e),v(f)?f:null},t=function(b,a){return new q(function(c){var d;d=new XMLHttpRequest,d.onreadystatechange=function(){4===d.readyState&&c({status:d.status,blob:this.response})},d.open("GET",b,!0),h.each(a,function(f,e){d.setRequestHeader(e,f)}),d.responseType="blob",d.send()})},s=function(a){return new q(function(b){var d=new FileReader;d.onload=function(e){var f=e.target;b(f.result)},d.readAsText(a)})},r=function(d){var c;try{c=JSON.parse(d)}catch(d){}return c};return{traverse:u,readBlob:s,requestUrlAsBlob:t,parseJson:r}}),l("a",["6","7","h"],function(B,A,z){function y(a){return z.requestUrlAsBlob(a,{}).then(function(c){return c.status>=400?v(c.status):B.resolve(c.blob)})}var x=function(e,d){var f=e.indexOf("?")===-1?"?":"&";return/[?&]apiKey=/.test(e)||!d?e:e+f+"apiKey="+encodeURIComponent(d)},w=function(b){return 400===b||403===b||500===b},v=function(a){return B.reject("ImageProxy HTTP error: "+a)},u=function(a){B.reject("ImageProxy Service error: "+a)},t=function(d,c){return z.readBlob(c).then(function(f){var e=z.parseJson(f),g=z.traverse(e,["error","type"]);return u(g?g:"Invalid JSON")})},s=function(d,c){return w(d)?t(d,c):v(d)},r=function(a,c){return z.requestUrlAsBlob(x(a,c),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":c}).then(function(d){return d.status>=400?s(d.status,d.blob):B.resolve(d.blob)})},q=function(d,c){return c?r(d,c):y(d)};return{getUrl:q}}),l("i",["g"],function(b){return b("tinymce.dom.DOMUtils")}),l("j",["g"],function(b){return b("tinymce.ui.Container")}),l("k",["g"],function(b){return b("tinymce.ui.Factory")}),l("l",["g"],function(b){return b("tinymce.ui.Form")}),l("u",["g"],function(b){return b("tinymce.geom.Rect")}),l("v",["g"],function(b){return b("tinymce.ui.Control")}),l("w",["g"],function(b){return b("tinymce.ui.DragHelper")}),l("y",["g"],function(b){return b("tinymce.dom.DomQuery")}),l("z",["g"],function(b){return b("tinymce.util.Observable")}),l("10",["g"],function(b){return b("tinymce.util.VK")}),l("x",["y","w","u","7","z","10"],function(q,h,v,u,t,s){var r=0;return function(T,S,R,Q,P){function O(x,w){return{x:w.x+x.x,y:w.y+x.y,w:w.w,h:w.h}}function N(x,w){return{x:w.x-x.x,y:w.y-x.y,w:w.w,h:w.h}}function M(){return N(R,T)}function L(U,D,C,B){var A,z,y,x,w;A=D.x,z=D.y,y=D.w,x=D.h,A+=C*U.deltaX,z+=B*U.deltaY,y+=C*U.deltaW,x+=B*U.deltaH,y<20&&(y=20),x<20&&(x=20),w=T=v.clamp({x:A,y:z,w:y,h:x},R,"move"==U.name),w=N(R,w),b.fire("updateRect",{rect:w}),e(w)}function J(){function w(x){var y;return new h(E,{document:Q.ownerDocument,handle:E+"-"+x.name,start:function(){y=T},drag:function(z){L(x,y,z.deltaX,z.deltaY)}})}q('<div id="'+E+'" class="'+G+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(Q),u.each(I,function(x){q("#"+E,Q).append('<div id="'+E+"-"+x+'"class="'+G+'croprect-block" style="display: none" data-mce-bogus="all">')}),u.each(a,function(x){q("#"+E,Q).append('<div id="'+E+"-"+x.name+'" class="'+G+"croprect-handle "+G+"croprect-handle-"+x.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+x.label+'" aria-grabbed="false">')}),K=u.map(a,w),F(T),q(Q).on("focusin focusout",function(x){q(x.target).attr("aria-grabbed","focus"===x.type)}),q(Q).on("keydown",function(y){function x(B,A,U,D,C){B.stopPropagation(),B.preventDefault(),L(z,U,D,C)}var z;switch(u.each(a,function(A){if(y.target.id==E+"-"+A.name){return z=A,!1}}),y.keyCode){case s.LEFT:x(y,z,T,-10,0);break;case s.RIGHT:x(y,z,T,10,0);break;case s.UP:x(y,z,T,0,-10);break;case s.DOWN:x(y,z,T,0,10);break;case s.ENTER:case s.SPACEBAR:y.preventDefault(),P()}})}function H(w){var x;x=u.map(a,function(y){return"#"+E+"-"+y.name}).concat(u.map(I,function(y){return"#"+E+"-"+y})).join(","),w?q(x,Q).show():q(x,Q).hide()}function F(w){function x(y,z){z.h<0&&(z.h=0),z.w<0&&(z.w=0),q("#"+E+"-"+y,Q).css({left:z.x,top:z.y,width:z.w,height:z.h})}u.each(a,function(y){q("#"+E+"-"+y.name,Q).css({left:w.w*y.xMul+w.x,top:w.h*y.yMul+w.y})}),x("top",{x:S.x,y:S.y,w:S.w,h:w.y-S.y}),x("right",{x:w.x+w.w,y:w.y,w:S.w-w.x-w.w+S.x,h:w.h}),x("bottom",{x:S.x,y:w.y+w.h,w:S.w,h:S.h-w.y-w.h+S.y}),x("left",{x:S.x,y:w.y,w:w.x-S.x,h:w.h}),x("move",w)}function g(w){T=w,F(T)}function f(w){S=w,F(T)}function e(w){g(O(R,w))}function d(w){R=w,F(T)}function c(){u.each(K,function(w){w.destroy()}),K=[]}var b,a,K,I,G="mce-",E=G+"crid-"+r++;return a=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],I=["top","right","bottom","left"],J(Q),b=u.extend({toggleVisibility:H,setClampRect:d,setRect:g,getInnerRect:M,setInnerRect:e,setViewPortRect:f,destroy:c},t)}}),l("m",["u","v","w","6","7","x"],function(q,h,v,u,t,s){function r(b){return new u(function(a){function d(){b.removeEventListener("load",d),a(b)}b.complete?a(b):b.addEventListener("load",d)})}return h.extend({Defaults:{classes:"imagepanel"},selection:function(b){return arguments.length?(this.state.set("rect",b),this):this.state.get("rect")},imageSize:function(){var b=this.state.get("viewRect");return{w:b.w,h:b.h}},toggleCropRect:function(b){this.state.set("cropEnabled",b)},imageSrc:function(a){var f=this,e=new Image;e.src=a,r(e).then(function(){var c,x,w=f.state.get("viewRect");if(x=f.$el.find("img"),x[0]){x.replaceWith(e)}else{var d=document.createElement("div");d.className="mce-imagepanel-bg",f.getEl().appendChild(d),f.getEl().appendChild(e)}c={x:0,y:0,w:e.naturalWidth,h:e.naturalHeight},f.state.set("viewRect",c),f.state.set("rect",q.inflate(c,-20,-20)),w&&w.w==c.w&&w.h==c.h||f.zoomFit(),f.repaintImage(),f.fire("load")})},zoom:function(b){return arguments.length?(this.state.set("zoom",b),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var x,w,D,C,B,A,z,y=this;z=10,x=y.$el.find("img"),w=y.getEl().clientWidth,D=y.getEl().clientHeight,C=x[0].naturalWidth,B=x[0].naturalHeight,A=Math.min((w-z)/C,(D-z)/B),A>=1&&(A=1),y.zoom(A)},repaintImage:function(){var G,F,E,D,C,B,A,z,y,x,w;w=this.getEl(),y=this.zoom(),x=this.state.get("rect"),A=this.$el.find("img"),z=this.$el.find(".mce-imagepanel-bg"),C=w.offsetWidth,B=w.offsetHeight,E=A[0].naturalWidth*y,D=A[0].naturalHeight*y,G=Math.max(0,C/2-E/2),F=Math.max(0,B/2-D/2),A.css({left:G,top:F,width:E,height:D}),z.css({left:G,top:F,width:E,height:D}),this.cropRect&&(this.cropRect.setRect({x:x.x*y+G,y:x.y*y+F,w:x.w*y,h:x.h*y}),this.cropRect.setClampRect({x:G,y:F,w:E,h:D}),this.cropRect.setViewPortRect({x:0,y:0,w:C,h:B}))},bindStates:function(){function d(b){c.cropRect=new s(b,c.state.get("viewRect"),c.state.get("viewRect"),c.getEl(),function(){c.fire("crop")}),c.cropRect.on("updateRect",function(e){var g=e.rect,f=c.zoom();g={x:Math.round(g.x/f),y:Math.round(g.y/f),w:Math.round(g.w/f),h:Math.round(g.h/f)},c.state.set("rect",g)}),c.on("remove",c.cropRect.destroy)}var c=this;c.state.on("change:cropEnabled",function(b){c.cropRect.toggleVisibility(b.value),c.repaintImage()}),c.state.on("change:zoom",function(){c.repaintImage()}),c.state.on("change:rect",function(b){var a=b.value;c.cropRect||d(a),c.cropRect.setRect(a)})}})}),l("n",[],function(){return function(){function q(d){var c;return c=s.splice(++r),s.push(d),{state:d,removed:c}}function h(){if(u()){return s[--r]}}function v(){if(t()){return s[++r]}}function u(){return r>0}function t(){return r!=-1&&r<s.length-1}var s=[],r=-1;return{data:s,add:q,undo:h,redo:v,canUndo:u,canRedo:t}}}),l("b",["1","2","i","j","k","l","6","7","m","n"],function(E,D,C,B,A,z,y,x,w,v){function u(b){return{blob:b,url:URL.createObjectURL(b)}}function t(b){b&&URL.revokeObjectURL(b.url)}function s(b){x.each(b,t)}function r(aV,aU,aT){function aS(F){var g,I,H,G;g=ak.find("#w")[0],I=ak.find("#h")[0],H=parseInt(g.value(),10),G=parseInt(I.value(),10),ak.find("#constrain")[0].checked()&&b&&aG&&H&&G&&("w"==F.control.settings.name?(G=Math.round(H*aB),I.value(G)):(H=Math.round(G*d),g.value(H))),b=H,aG=G}function aR(g){return Math.round(100*g)+"%"}function aQ(){ak.find("#undo").disabled(!aJ.canUndo()),ak.find("#redo").disabled(!aJ.canRedo()),ak.statusbar.find("#save").disabled(!aJ.canUndo())}function aP(){ak.find("#undo").disabled(!0),ak.find("#redo").disabled(!0)}function aO(g){g&&ad.imageSrc(g.url)}function aN(g){return function(){var F=x.grep(aA,function(G){return G.settings.name!=g});x.each(F,function(G){G.hide()}),g.show(),g.focus()}}function aM(g){ah=u(g),aO(ah)}function aL(g){aV=u(g),aO(aV),s(aJ.add(aV).removed),aQ()}function aK(){var g=ad.selection();E.blobToImageResult(aV.blob).then(function(F){D.crop(F,g.x,g.y,g.w,g.h).then(aC).then(function(G){aL(G),ax()})})}function aI(g){var F=[].slice.call(arguments,1);return function(){var G=ah||aV;E.blobToImageResult(G.blob).then(function(H){g.apply(this,[H].concat(F)).then(aC).then(aM)})}}function aH(g){var F=[].slice.call(arguments,1);return function(){E.blobToImageResult(aV.blob).then(function(G){g.apply(this,[G].concat(F)).then(aC).then(aL)})}}function ax(){aO(aV),t(ah),aN(aj)(),aQ()}function aw(){ah&&(aL(ah.blob),ax())}function av(){var g=ad.zoom();g<2&&(g+=0.1),ad.zoom(g)}function au(){var g=ad.zoom();g>0.1&&(g-=0.1),ad.zoom(g)}function at(){aV=aJ.undo(),aO(aV),aQ()}function ar(){aV=aJ.redo(),aO(aV),aQ()}function aq(){aU(aV.blob),ak.close()}function ap(g){return new z({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:g})}function ao(g,F){return ap([{text:"Back",onclick:ax},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aw}]).hide().on("show",function(){aP(),E.blobToImageResult(aV.blob).then(function(G){return F(G)}).then(aC).then(function(H){var G=u(H);aO(G),t(ah),ah=G})})}function an(g,J,I,H,G){function F(K){E.blobToImageResult(aV.blob).then(function(L){return J(L,K)}).then(aC).then(function(M){var L=u(M);aO(L),t(ah),ah=L})}return ap([{text:"Back",onclick:ax},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(K){F(K.value)},minValue:H,maxValue:G,value:I,previewFilter:aR},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aw}]).hide().on("show",function(){this.find("slider").value(I),aP()})}function am(F,g){function G(){var H,J,I;H=ak.find("#r")[0].value(),J=ak.find("#g")[0].value(),I=ak.find("#b")[0].value(),g(aV.blob,H,J,I).then(function(L){var K=u(L);aO(K),t(ah),ah=K})}return ap([{text:"Back",onclick:ax},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aR},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aR},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:G,previewFilter:aR},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aw}]).hide().on("show",function(){ak.find("#r,#g,#b").value(1),aP()})}function al(g){g.control.value()===!0&&(aB=aG/b,d=b/aG)}var ak,aj,ai,ah,ag,af,ae,ad,ac,ab,h,f,e,c,aD,aX,ay,aW,aE,az,a,aF,aA,b,aG,aB,d,aJ=new v,aC=function(g){return g.toBlob()};ag=ap([{text:"Back",onclick:ax},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aK}]).hide().on("show hide",function(g){ad.toggleCropRect("show"==g.type)}).on("show",aP),af=ap([{text:"Back",onclick:ax},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:aS},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:aS},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:al},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(g){var G=parseInt(ak.find("#w").value(),10),F=parseInt(ak.find("#h").value(),10);g.preventDefault(),aH(D.resize,G,F)(),ax()}).on("show",aP),ae=ap([{text:"Back",onclick:ax},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:aI(D.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:aI(D.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:aI(D.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:aI(D.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:aw}]).hide().on("show",aP),h=ao("Invert",D.invert),aE=ao("Sharpen",D.sharpen),az=ao("Emboss",D.emboss),f=an("Brightness",D.brightness,0,-1,1),e=an("Hue",D.hue,180,0,360),c=an("Saturate",D.saturate,0,-1,1),aD=an("Contrast",D.contrast,0,-1,1),aX=an("Grayscale",D.grayscale,0,0,1),ay=an("Sepia",D.sepia,0,0,1),aW=am("Colorize",D.colorize),a=an("Gamma",D.gamma,0,-1,1),aF=an("Exposure",D.exposure,1,0,2),ai=ap([{text:"Back",onclick:ax},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:aN(e)},{text:"saturate",icon:"saturate",onclick:aN(c)},{text:"sepia",icon:"sepia",onclick:aN(ay)},{text:"emboss",icon:"emboss",onclick:aN(az)},{text:"exposure",icon:"exposure",onclick:aN(aF)},{type:"spacer",flex:1}]).hide(),aj=ap([{tooltip:"Crop",icon:"crop",onclick:aN(ag)},{tooltip:"Resize",icon:"resize2",onclick:aN(af)},{tooltip:"Orientation",icon:"orientation",onclick:aN(ae)},{tooltip:"Brightness",icon:"sun",onclick:aN(f)},{tooltip:"Sharpen",icon:"sharpen",onclick:aN(aE)},{tooltip:"Contrast",icon:"contrast",onclick:aN(aD)},{tooltip:"Color levels",icon:"drop",onclick:aN(aW)},{tooltip:"Gamma",icon:"gamma",onclick:aN(a)},{tooltip:"Invert",icon:"invert",onclick:aN(h)}]),ad=new w({flex:1,imageSrc:aV.url}),ac=new B({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:at},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:ar},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:av},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:au}]}),ab=new B({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[ac,ad]}),aA=[aj,ag,af,ae,ai,h,f,e,c,aD,aX,ay,aW,aE,az,a,aF],ak=A.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(C.DOM.getViewPort().w,800),minHeight:Math.min(C.DOM.getViewPort().h,650),title:"Edit image",items:aA.concat([ab]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:aq},{text:"Cancel",onclick:"close"}]}),ak.renderTo(document.body).reflow(),ak.on("close",function(){aT(),s(aJ.data),aJ=null,ah=null}),aJ.add(aV),aQ(),ad.on("load",function(){b=ad.imageSize().w,aG=ad.imageSize().h,aB=aG/b,d=b/aG,ak.find("#w").value(b),ak.find("#h").value(aG)}),ad.on("crop",aK)}function q(b){return new y(function(a,d){return b.toBlob().then(function(c){r(u(c),a,d)})})}return{edit:q}}),l("0",["1","2","3","4","5","6","7","8","9","a","b"],function(B,A,z,y,x,w,v,u,t,s,r){var q=function(Y){function X(d){Y.notificationManager.open({text:d,type:"error"})}function W(){return Y.selection.getNode()}function V(C){var d=C.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return d?Y.dom.encode(d[1]):null}function U(){return"imagetools"+e++}function T(C){var d=C.src;return 0===d.indexOf("data:")||0===d.indexOf("blob:")||new u(d).host===Y.documentBaseURI.host}function R(d){return v.inArray(Y.settings.imagetools_cors_hosts,new u(d.src).host)!==-1}function P(){return Y.settings.api_key||Y.settings.imagetools_api_key}function N(d){var D,C=d.src;return R(d)?s.getUrl(d.src,null):T(d)?B.imageToBlob(d):(C=Y.settings.imagetools_proxy,C+=(C.indexOf("?")===-1?"?":"&")+"url="+encodeURIComponent(d.src),D=P(),s.getUrl(C,D))}function L(){var d;return d=Y.editorUpload.blobCache.getByUri(W().src),d?d.blob():N(W())}function J(){I=x.setEditorTimeout(Y,function(){Y.editorUpload.uploadImagesAuto()},Y.settings.images_upload_timeout||30000)}function h(){clearTimeout(I)}function f(C,d){return C.toBlob().then(function(Z){var H,G,F,E,D;return F=Y.editorUpload.blobCache,D=W(),H=D.src,Y.settings.images_reuse_filename&&(E=F.getByUri(H),E?(H=E.uri(),G=E.name()):G=V(H)),E=F.create({id:U(),blob:Z,base64:C.toBase64(),uri:H,name:G}),F.add(E),Y.undoManager.transact(function(){function aa(){Y.$(D).off("load",aa),Y.nodeChanged(),d?Y.editorUpload.uploadImagesAuto():(h(),J())}Y.$(D).on("load",aa),Y.$(D).attr({src:E.blobUri()}).removeAttr("data-mce-src")}),E})}function c(d){return function(){return Y._scanForImages().then(L).then(B.blobToImageResult).then(d).then(f,X)}}function b(d){return function(){return c(function(D){var C=t.getImageSize(W());return C&&t.setImageSize(W(),{w:C.h,h:C.w}),A.rotate(D,d)})()}}function a(d){return function(){return c(function(C){return A.flip(C,d)})()}}function S(){var C=W(),F=t.getNaturalImageSize(C),E=function(G){return new w(function(d){B.blobToImage(G).then(function(H){var Z=t.getNaturalImageSize(H);F.w==Z.w&&F.h==Z.h||t.getImageSize(C)&&t.setImageSize(C,Z),URL.revokeObjectURL(H.src),d(G)})})},D=function(d){return r.edit(d).then(E).then(B.blobToImageResult).then(function(G){f(G,!0)},function(){})};C&&B.imageToImageResult(C).then(D,X)}function Q(){Y.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),Y.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),Y.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),Y.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),Y.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),Y.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function O(){Y.on("NodeChange",function(d){g&&g.src!=d.element.src&&(h(),Y.editorUpload.uploadImagesAuto(),g=void 0),M(d.element)&&(g=d.element)})}function M(C){var d=Y.dom.is(C,"img:not([data-mce-object],[data-mce-placeholder])");return d&&(T(C)||R(C)||Y.settings.imagetools_proxy)}function K(){var d=Y.settings.imagetools_toolbar;d||(d="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),Y.addContextToolbar(M,d)}var I,g,e=0;z.fileApi&&(v.each({mceImageRotateLeft:b(-90),mceImageRotateRight:b(90),mceImageFlipVertical:a("v"),mceImageFlipHorizontal:a("h"),mceEditImage:S},function(C,d){Y.addCommand(d,C)}),Q(),K(),O())};return y.add("imagetools",q),function(){}}),o("0")()}();