!function(){var j={},i=function(a){for(var v=j[a],u=v.deps,t=v.defn,s=u.length,r=new Array(s),q=0;q<s;++q){r[q]=o(u[q])}var d=t.apply(null,r);if(void 0===d){throw"module ["+a+"] returned undefined"}v.instance=d},p=function(a,f,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===f){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}j[a]={deps:f,defn:e,instance:void 0}},o=function(b){var a=j[b];if(void 0===a){throw"module ["+b+"] was undefined"}return void 0===a.instance&&i(b),a.instance},n=function(g,d){for(var r=g.length,q=new Array(r),h=0;h<r;++h){q.push(o(g[h]))}d.apply(null,d)},m={};m.bolt={module:{api:{define:p,require:n,demand:o}}};var l=p,k=function(d,c){l(d,[],function(){return c})};k("8",tinymce.util.Tools.resolve),l("1",["8"],function(b){return b("tinymce.html.Node")}),l("2",["8"],function(b){return b("tinymce.PluginManager")}),l("3",["8"],function(b){return b("tinymce.util.Tools")}),l("9",["8"],function(b){return b("tinymce.html.Writer")}),l("a",["8"],function(b){return b("tinymce.html.SaxParser")}),l("b",["8"],function(b){return b("tinymce.html.Schema")}),l("5",["3","9","a","b"],function(g,f,r,q){var h=function(b,s){if(b.settings.media_filter_html===!1){return s}var d,c=new f;return new r({validate:!1,allow_conditional_comments:!1,special:"script,noscript",comment:function(e){c.comment(e)},cdata:function(e){c.cdata(e)},text:function(t,e){c.text(t,e)},start:function(a,v,u){if(d=!0,"script"!==a&&"noscript"!==a){for(var t=0;t<v.length;t++){if(0===v[t].name.indexOf("on")){return}"style"===v[t].name&&(v[t].value=b.dom.serializeStyle(b.dom.parseStyle(v[t].value),a))}c.start(a,v,u),d=!1}},end:function(e){d||c.end(e)}},new q({})).parse(s),c.getContent()};return{sanitize:h}}),l("c",[],function(){var b=function(e,d){if(e){for(var f=0;f<e.length;f++){if(d.indexOf(e[f].filter)!==-1){return e[f]}}}};return{getVideoScriptMatch:b}}),l("d",["8"],function(b){return b("tinymce.Env")}),l("4",["5","c","1","d"],function(y,x,w,v){var u=function(d,c){var h,g=c.name;return h=new w("img",1),h.shortEnded=!0,s(d,c,h),h.attr({width:c.attr("width")||"300",height:c.attr("height")||("audio"===g?"30":"150"),style:c.attr("style"),src:v.transparentSrc,"data-mce-object":g,"class":"mce-object mce-object-"+g}),h},t=function(g,c){var C,B,A,z=c.name;return C=new w("span",1),C.attr({contentEditable:"false",style:c.attr("style"),"data-mce-object":z,"class":"mce-preview-object mce-object-"+z}),s(g,c,C),B=new w(z,1),B.attr({src:c.attr("src"),allowfullscreen:c.attr("allowfullscreen"),width:c.attr("width")||"300",height:c.attr("height")||("audio"===z?"30":"150"),frameborder:"0"}),A=new w("span",1),A.attr("class","mce-shim"),C.append(B),C.append(A),C},s=function(a,F,E){var D,C,B,A,z;for(B=F.attributes,A=B.length;A--;){D=B[A].name,C=B[A].value,"width"!==D&&"height"!==D&&"style"!==D&&("data"!==D&&"src"!==D||(C=a.convertURL(C,D)),E.attr("data-mce-p-"+D,C))}z=F.firstChild&&F.firstChild.value,z&&(E.attr("data-mce-html",escape(y.sanitize(a,z))),E.firstChild=null)},r=function(b){for(;b=b.parent;){if(b.attr("data-ephox-embed-iri")){return !0}}return !1},q=function(b){return function(f){for(var e,d,a=f.length;a--;){e=f[a],e.parent&&(e.parent.attr("data-mce-object")||("script"!==e.name||(d=x.getVideoScriptMatch(b.settings.media_scripts,e.attr("src"))))&&(d&&(d.width&&e.attr("width",d.width.toString()),d.height&&e.attr("height",d.height.toString())),"iframe"===e.name&&b.settings.media_live_embeds!==!1&&v.ceFalse?r(e)||e.replace(t(b,e)):r(e)||e.replace(u(b,e))))}}};return{createPreviewIframeNode:t,createPlaceholderNode:u,placeHolderConverter:q}}),l("e",["8"],function(b){return b("tinymce.dom.DOMUtils")}),l("f",[],function(){var f=function(b){return b.replace(/px$/,"")},e=function(b){return/^[0-9.]+$/.test(b)?b+"px":b},h=function(a){return function(b){return b?f(b.style[a]):""}},g=function(b){return function(q,a){q&&(q.style[b]=e(a))}};return{getMaxWidth:h("maxWidth"),getMaxHeight:h("maxHeight"),setMaxWidth:g("maxWidth"),setMaxHeight:g("maxHeight")}}),l("6",["9","a","b","e","f"],function(B,A,z,y,x){var w=y.DOM,v=function(h,g){var F,E,D,C;for(F in g){if(D=""+g[F],h.map[F]){for(E=h.length;E--;){C=h[E],C.name===F&&(D?(h.map[F]=D,C.value=D):(delete h.map[F],h.splice(E,1)))}}else{D&&(h.push({name:F,value:D}),h.map[F]=D)}}},u=function(f){var b=new B,a=new A(b);return a.parse(f),b.getContent()},t=function(D,C,g){var c,b=new B,a=0;return new A({validate:!1,allow_conditional_comments:!0,special:"script,noscript",comment:function(d){b.comment(d)},cdata:function(d){b.cdata(d)},text:function(e,d){b.text(e,d)},start:function(e,d,f){switch(e){case"video":case"object":case"embed":case"img":case"iframe":void 0!==C.height&&void 0!==C.width&&v(d,{width:C.width,height:C.height})}if(g){switch(e){case"video":v(d,{poster:C.poster,src:""}),C.source2&&v(d,{src:""});break;case"iframe":v(d,{src:C.source1});break;case"source":if(a++,a<=2&&(v(d,{src:C["source"+a],type:C["source"+a+"mime"]}),!C["source"+a])){return}break;case"img":if(!C.poster){return}c=!0}}b.start(e,d,f)},end:function(f){if("video"===f&&g){for(var e=1;e<=2;e++){if(C["source"+e]){var E=[];E.map={},a<e&&(v(E,{src:C["source"+e],type:C["source"+e+"mime"]}),b.start("source",E,!0))}}}if(C.poster&&"object"===f&&g&&!c){var h=[];h.map={},v(h,{src:C.poster,width:C.width,height:C.height}),b.start("img",h,!0)}b.end(f)}},new z({})).parse(D),b.getContent()},s=function(d){var c=w.createFragment(d);return""!==w.getAttrib(c.firstChild,"data-ephox-embed-iri")},r=function(f,e){var h=w.createFragment(f),g=h.firstChild;return x.setMaxWidth(g,e.width),x.setMaxHeight(g,e.height),u(g.outerHTML)},q=function(e,d,f){return s(e)?r(e,d):t(e,d,f)};return{updateHtml:q}}),l("g",["8"],function(b){return b("tinymce.util.Delay")}),l("h",["3","a","b","e","c","f"],function(B,A,z,y,x,w){var v=y.DOM,u=function(b){return v.getAttrib(b,"data-ephox-embed-iri")},t=function(d){var c=v.createFragment(d);return""!==u(c.firstChild)},s=function(e,b){var a={};return new A({validate:!1,allow_conditional_comments:!0,special:"script,noscript",start:function(c,h){if(a.source1||"param"!==c||(a.source1=h.map.movie),"iframe"!==c&&"object"!==c&&"embed"!==c&&"video"!==c&&"audio"!==c||(a.type||(a.type=c),a=B.extend(h.map,a)),"script"===c){var f=x.getVideoScriptMatch(e,h.map.src);if(!f){return}a={type:"script",source1:h.map.src,width:f.width,height:f.height}}"source"===c&&(a.source1?a.source2||(a.source2=h.map.src):a.source1=h.map.src),"img"!==c||a.poster||(a.poster=h.map.src)}}).parse(b),a.source1=a.source1||a.src||a.data,a.source2=a.source2||"",a.poster=a.poster||"",a},r=function(e){var d=v.createFragment(e),f=d.firstChild;return{type:"ephox-embed-iri",source1:u(f),source2:"",poster:"",width:w.getMaxWidth(f),height:w.getMaxHeight(f)}},q=function(d,c){return t(c)?r(c):s(d,c)};return{htmlToData:q}}),l("m",[],function(){var b=function(f){var e={mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},h=f.toLowerCase().split(".").pop(),g=e[h];return g?g:""};return{guess:b}}),l("n",[],function(){var b=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\-_]+(?:\?.+)?)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:!0}];return{urlPatterns:b}}),l("k",["m","h","n","c","6","3"],function(q,h,v,u,t,s){var r=function(f,e){var d="",c=s.extend({},e);if(!c.source1&&(s.extend(c,h.htmlToData(f.settings.media_scripts,c.embed)),!c.source1)){return""}if(c.source2||(c.source2=""),c.poster||(c.poster=""),c.source1=f.convertURL(c.source1,"source"),c.source2=f.convertURL(c.source2,"source"),c.source1mime=q.guess(c.source1),c.source2mime=q.guess(c.source2),c.poster=f.convertURL(c.poster,"poster"),s.each(v.urlPatterns,function(w){var g,y,x=w.regex.exec(c.source1);if(x){for(y=w.url,g=0;x[g];g++){y=y.replace("$"+g,function(){return x[g]})}c.source1=y,c.type=w.type,c.allowFullscreen=w.allowFullscreen,c.width=c.width||w.w,c.height=c.height||w.h}}),c.embed){d=t.updateHtml(c.embed,c,!0)}else{var b=u.getVideoScriptMatch(f.settings.media_scripts,c.source1);if(b&&(c.type="script",c.width=b.width,c.height=b.height),c.width=c.width||300,c.height=c.height||150,s.each(c,function(w,g){c[g]=f.dom.encode(w)}),"iframe"===c.type){var a=c.allowFullscreen?' allowFullscreen="1"':"";d+='<iframe src="'+c.source1+'" width="'+c.width+'" height="'+c.height+'"'+a+"></iframe>"}else{"application/x-shockwave-flash"===c.source1mime?(d+='<object data="'+c.source1+'" width="'+c.width+'" height="'+c.height+'" type="application/x-shockwave-flash">',c.poster&&(d+='<img src="'+c.poster+'" width="'+c.width+'" height="'+c.height+'" />'),d+="</object>"):c.source1mime.indexOf("audio")!==-1?f.settings.audio_template_callback?d=f.settings.audio_template_callback(c):d+='<audio controls="controls" src="'+c.source1+'">'+(c.source2?'\n<source src="'+c.source2+'"'+(c.source2mime?' type="'+c.source2mime+'"':"")+" />\n":"")+"</audio>":"script"===c.type?d+='<script src="'+c.source1+'"><\/script>':d=f.settings.video_template_callback?f.settings.video_template_callback(c):'<video width="'+c.width+'" height="'+c.height+'"'+(c.poster?' poster="'+c.poster+'"':"")+' controls="controls">\n<source src="'+c.source1+'"'+(c.source1mime?' type="'+c.source1mime+'"':"")+" />\n"+(c.source2?'<source src="'+c.source2+'"'+(c.source2mime?' type="'+c.source2mime+'"':"")+" />\n":"")+"</video>"}}return d};return{dataToHtml:r}}),l("l",["8"],function(b){return b("tinymce.util.Promise")}),l("i",["k","l"],function(h,g){var t=function(b,v,u){var f={};return new g(function(a,d){var c=function(e){return e.html&&(f[b.source1]=e),a({url:b.source1,html:e.html?e.html:v(b)})};f[b.source1]?c(f[b.source1]):u({url:b.source1},c,d)})},s=function(b,d){return new g(function(a){a({html:d(b),url:b.source1})})},r=function(a){return function(b){return h.dataToHtml(a,b)}},q=function(d,c){var e=d.settings.media_url_resolver;return e?t(c,r(d),e):s(c,r(d))};return{getEmbedHtml:q}}),l("j",[],function(){var h=function(d,c){d.state.set("oldVal",d.value()),c.state.set("oldVal",c.value())},g=function(u,f){var x=u.find("#width")[0],w=u.find("#height")[0],v=u.find("#constrain")[0];x&&w&&v&&f(x,w,v.checked())},t=function(a,z,y){var x=a.state.get("oldVal"),w=z.state.get("oldVal"),v=a.value(),u=z.value();y&&x&&w&&v&&u&&(v!==x?(u=Math.round(v/x*u),isNaN(u)||z.value(u)):(v=Math.round(u/w*v),isNaN(v)||a.value(v))),h(a,z)},s=function(a){g(a,h)},r=function(b){g(b,t)},q=function(d){var c=function(){d(function(b){r(b)})};return{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:5,onchange:c,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:5,onchange:c,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}};return{createUi:q,syncSize:s,updateSize:r}}),l("7",["g","h","6","i","f","3","d","j"],function(J,I,H,G,F,E,D,C){var B=D.ie&&D.ie<=8?"onChange":"onInput",A=function(b){return function(a){var d=a&&a.msg?"Media embed handler error: "+a.msg:"Media embed handler threw unknown error.";b.notificationManager.open({type:"error",text:d})}},z=function(b){var f=b.selection.getNode(),e=f.getAttribute("data-ephox-embed-iri");return e?{source1:e,"data-ephox-embed-iri":e,width:F.getMaxWidth(f),height:F.getMaxHeight(f)}:f.getAttribute("data-mce-object")?I.htmlToData(b.settings.media_scripts,b.serializer.serialize(f,{selection:!0})):{}},y=function(d){var c=d.selection.getNode();if(c.getAttribute("data-mce-object")||c.getAttribute("data-ephox-embed-iri")){return d.selection.getContent()}},x=function(b,d){return function(h){var f=h.html,c=b.find("#embed")[0],a=E.extend(I.htmlToData(d.settings.media_scripts,f),{source1:h.url});b.fromJSON(a),c&&(c.value(f),C.updateSize(b))}},w=function(g,f){var r,q,h=g.dom.select("img[data-mce-object]");for(r=0;r<f.length;r++){for(q=h.length-1;q>=0;q--){f[r]===h[q]&&h.splice(q,1)}}g.selection.select(h[0])},v=function(e,d){var f=e.dom.select("img[data-mce-object]");e.insertContent(d),w(e,f),e.nodeChanged()},u=function(d,c){var f=d.toJSON();f.embed=H.updateHtml(f.embed,f),f.embed?v(c,f.embed):G.getEmbedHtml(c,f).then(function(b){v(c,b.html)})["catch"](A(c))},t=function(d,c){E.each(c,function(a,e){d.find("#"+e).value(a)})},s=function(q){var h,f,d=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source",onpaste:function(){setTimeout(function(){G.getEmbedHtml(q,h.toJSON()).then(x(h,q))["catch"](A(q))},1)},onchange:function(a){G.getEmbedHtml(q,h.toJSON()).then(x(h,q))["catch"](A(q)),t(h,a.meta)},onbeforecall:function(e){e.meta=h.toJSON()}}],c=[],b=function(e){e(h),f=h.toJSON(),h.find("#embed").value(H.updateHtml(f.embed,f))};if(q.settings.media_alt_source!==!1&&c.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"}),q.settings.media_poster!==!1&&c.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"}),q.settings.media_dimensions!==!1){var M=C.createUi(b);d.push(M)}f=z(q);var L={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:y(q),multiline:!0,rows:5,label:"Source"},K=function(){f=E.extend({},I.htmlToData(q.settings.media_scripts,this.value())),this.parent().parent().fromJSON(f)};L[B]=K,h=q.windowManager.open({title:"Insert/edit media",data:f,bodyType:"tabpanel",body:[{title:"General",type:"form",items:d},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},L]},{title:"Advanced",type:"form",items:c}],onSubmit:function(){C.updateSize(h),u(h,q)}}),C.syncSize(h)};return{showDialog:s}}),l("0",["1","2","3","4","5","6","7"],function(r,q,x,w,v,u,t){var s=function(a){a.on("ResolveName",function(d){var c;1===d.target.nodeType&&(c=d.target.getAttribute("data-mce-object"))&&(d.name=c)}),a.on("preInit",function(){var c=a.schema.getSpecialElements();x.each("video audio iframe object".split(" "),function(d){c[d]=new RegExp("</"+d+"[^>]*>","gi")});var b=a.schema.getBoolAttrs();x.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(d){b[d]={}}),a.parser.addNodeFilter("iframe,video,audio,object,embed,script",w.placeHolderConverter(a)),a.serializer.addAttributeFilter("data-mce-object",function(I,H){for(var G,F,E,D,C,B,A,z,y=I.length;y--;){if(G=I[y],G.parent){for(A=G.attr(H),F=new r(A,1),"audio"!==A&&"script"!==A&&(z=G.attr("class"),z&&z.indexOf("mce-preview-object")!==-1?F.attr({width:G.firstChild.attr("width"),height:G.firstChild.attr("height")}):F.attr({width:G.attr("width"),height:G.attr("height")})),F.attr({style:G.attr("style")}),D=G.attributes,E=D.length;E--;){var e=D[E].name;0===e.indexOf("data-mce-p-")&&F.attr(e.substr(11),D[E].value)}"script"===A&&F.attr("type","text/javascript"),C=G.attr("data-mce-html"),C&&(B=new r("#text",3),B.raw=!0,B.value=v.sanitize(a,unescape(C)),F.append(B)),G.replace(F)}}})}),a.on("click keyup",function(){var b=a.selection.getNode();b&&a.dom.hasClass(b,"mce-preview-object")&&a.dom.getAttrib(b,"data-mce-selected")&&b.setAttribute("data-mce-selected","2")}),a.on("ObjectSelected",function(d){var c=d.target.getAttribute("data-mce-object");"audio"!==c&&"script"!==c||d.preventDefault()}),a.on("objectResized",function(e){var d,f=e.target;f.getAttribute("data-mce-object")&&(d=f.getAttribute("data-mce-html"),d&&(d=unescape(d),f.setAttribute("data-mce-html",escape(u.updateHtml(d,{width:e.width,height:e.height})))))}),this.showDialog=function(){t.showDialog(a)},a.addButton("media",{tooltip:"Insert/edit media",onclick:this.showDialog,stateSelector:["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"]}),a.addMenuItem("media",{icon:"media",text:"Media",onclick:this.showDialog,context:"insert",prependToContext:!0}),a.on("setContent",function(){a.$("span.mce-preview-object").each(function(b,f){var e=a.$(f);0===e.find("span.mce-shim",f).length&&e.append('<span class="mce-shim"></span>')})}),a.addCommand("mceMedia",this.showDialog)};return q.add("media",s),function(){}}),o("0")()}();