!function(){var j={},i=function(a){for(var v=j[a],u=v.deps,t=v.defn,s=u.length,r=new Array(s),q=0;q<s;++q){r[q]=o(u[q])}var d=t.apply(null,r);if(void 0===d){throw"module ["+a+"] returned undefined"}v.instance=d},p=function(a,f,e){if("string"!=typeof a){throw"module id must be a string"}if(void 0===f){throw"no dependencies for "+a}if(void 0===e){throw"no definition function for "+a}j[a]={deps:f,defn:e,instance:void 0}},o=function(b){var a=j[b];if(void 0===a){throw"module ["+b+"] was undefined"}return void 0===a.instance&&i(b),a.instance},n=function(g,d){for(var r=g.length,q=new Array(r),h=0;h<r;++h){q.push(o(g[h]))}d.apply(null,d)},m={};m.bolt={module:{api:{define:p,require:n,demand:o}}};var l=p,k=function(d,c){l(d,[],function(){return c})};k("4",tinymce.util.Tools.resolve),l("1",["4"],function(b){return b("tinymce.PluginManager")}),l("2",["4"],function(b){return b("tinymce.util.I18n")}),l("3",["4"],function(b){return b("tinymce.util.Tools")}),l("0",["1","2","3"],function(e,d,f){return e.add("toc",function(G){function F(a){return !!a&&G.schema.isValidChild("div",a)}function E(a){return a&&G.dom.is(a,"."+v.className)&&G.getBody().contains(a)}function D(){var a=this;a.disabled(G.readonly||!B()),G.on("LoadContent SetContent change",function(){a.disabled(G.readonly||!B())})}function C(h){var g,q=[];for(g=1;g<=h;g++){q.push("h"+g)}return q.join(",")}function B(){return !(!v||!A(v).length)}function A(a){var h=C(a.depth),g=u(h);return g.length&&/^h[1-9]$/i.test(a.headerTag)&&(g=g.filter(function(r,q){return !G.dom.hasClass(q.parentNode,a.className)})),f.map(g,function(q){return q.id||(q.id=b()),{id:q.id,level:parseInt(q.nodeName.replace(/^H/i,""),10),title:u.text(q)}})}function z(h){var g,q=9;for(g=0;g<h.length;g++){if(h[g].level<q&&(q=h[g].level),1==q){return q}}return q}function y(a,q){var h="<"+a+' contenteditable="true">',g="</"+a+">";return h+G.dom.encode(q)+g}function x(h){var g=w(h);return'<div class="'+h.className+'" contenteditable="false">'+g+"</div>"}function w(r){var M,L,K,J,I="",s=A(r),q=z(s)-1;if(!s.length){return""}for(I+=y(r.headerTag,d.translate("Table of Contents")),M=0;M<s.length;M++){if(K=s[M],J=s[M+1]&&s[M+1].level,q===K.level){I+="<li>"}else{for(L=q;L<K.level;L++){I+="<ul><li>"}}if(I+='<a href="#'+K.id+'">'+K.title+"</a>",J!==K.level&&J){for(L=K.level;L>J;L--){I+="</li></ul><li>"}}else{I+="</li>",J||(I+="</ul>")}q=K.level}return I}var v,u=G.$,t={depth:3,headerTag:"h2",className:"mce-toc"},c=function(h){var g=0;return function(){var a=(new Date).getTime().toString(32);return h+a+(g++).toString(32)}},b=c("mcetoc_");G.on("PreInit",function(){var a=G.settings,g=parseInt(a.toc_depth,10)||0;v={depth:g>=1&&g<=9?g:t.depth,headerTag:F(a.toc_header)?a.toc_header:t.headerTag,className:a.toc_class?G.dom.encode(a.toc_class):t.className}}),G.on("PreProcess",function(h){var g=u("."+v.className,h.node);g.length&&(g.removeAttr("contentEditable"),g.find("[contenteditable]").removeAttr("contentEditable"))}),G.on("SetContent",function(){var g=u("."+v.className);g.length&&(g.attr("contentEditable",!1),g.children(":first-child").attr("contentEditable",!0))});var H=function(a){return !a.length||G.dom.getParents(a[0],".mce-offscreen-selection").length>0};G.addCommand("mceInsertToc",function(){var a=u("."+v.className);H(a)?G.insertContent(x(v)):G.execCommand("mceUpdateToc")}),G.addCommand("mceUpdateToc",function(){var a=u("."+v.className);a.length&&G.undoManager.transact(function(){a.html(w(v))})}),G.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:D}),G.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"}),G.addContextToolbar(E,"tocupdate"),G.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:D})}),function(){}}),o("0")()}();